{
  "name": "02. WF_CSKH_0611",
  "nodes": [
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "id": "7a14fcc9-d632-4ab5-8308-05a3cf695882",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        1020,
        300
      ],
      "credentials": {
        "openAiApi": {
          "id": "BpciZCOgdpJ79QO1",
          "name": "OpenAi account 23062025"
        }
      }
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.data || $json.text || $json.concatenated_data }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "=file_id",
                "value": "={{ $('Set File ID').first().json.file_id }}"
              },
              {
                "name": "file_title",
                "value": "={{ $('Set File ID').first().json.file_title }}"
              }
            ]
          }
        }
      },
      "id": "f8902c65-b407-4437-8d25-64a5f14671ce",
      "name": "Default Data Loader",
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1,
      "position": [
        3020,
        1140
      ]
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "614bf6bd-86de-4839-8c50-db565f48ceee",
      "name": "Embeddings OpenAI1",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        2740,
        1080
      ],
      "credentials": {
        "openAiApi": {
          "id": "BpciZCOgdpJ79QO1",
          "name": "OpenAi account 23062025"
        }
      }
    },
    {
      "parameters": {
        "content": "## Agent Tools for RAG",
        "height": 469,
        "width": 583,
        "color": 4
      },
      "id": "ce280942-60a7-4d9b-b9be-1ce1b0a65d53",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1780,
        0
      ]
    },
    {
      "parameters": {
        "content": "## Tool to Add a Google Drive File to Vector DB",
        "height": 80,
        "width": 573,
        "color": 5
      },
      "id": "aceb2b35-dbbe-465d-8566-7678e2963ced",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        20,
        480
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Set File ID').item.json.file_id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "text/plain"
            }
          }
        }
      },
      "id": "a6d1e8db-c3f7-49e0-acf1-f70cd79d1519",
      "name": "Download File",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1140,
        800
      ],
      "executeOnce": true,
      "credentials": {
        "googleApi": {
          "id": "UFYSZcd8CgntABwS",
          "name": "GSA_N"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "authentication": "serviceAccount",
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1JOXq1vwslcTjVGi4dAHb2hMuP0S5vNrF",
          "mode": "list",
          "cachedResultName": "04. ChamSocKhanhHang",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1JOXq1vwslcTjVGi4dAHb2hMuP0S5vNrF"
        },
        "event": "fileCreated",
        "options": {}
      },
      "id": "4ccbfe42-ebdb-4fab-b9df-4016dab69264",
      "name": "File Created",
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -220,
        560
      ],
      "credentials": {
        "googleApi": {
          "id": "UFYSZcd8CgntABwS",
          "name": "GSA_N"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "authentication": "serviceAccount",
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1JOXq1vwslcTjVGi4dAHb2hMuP0S5vNrF",
          "mode": "list",
          "cachedResultName": "04. ChamSocKhanhHang",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1JOXq1vwslcTjVGi4dAHb2hMuP0S5vNrF"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "id": "38d99495-d624-43a0-a26c-be7fb21ba9f0",
      "name": "File Updated",
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -200,
        800
      ],
      "credentials": {
        "googleApi": {
          "id": "UFYSZcd8CgntABwS",
          "name": "GSA_N"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Edit Fields').item.json.sessionId }}"
      },
      "id": "27b5bfc3-c461-4ba0-982f-7a9ae84fa579",
      "name": "Postgres Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1,
      "position": [
        1160,
        300
      ],
      "notesInFlow": false,
      "credentials": {
        "postgres": {
          "id": "vEJzSvEtz2wK5mnU",
          "name": "Postgres account 18_CSKH"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "documents",
        "filterType": "string",
        "filterString": "=metadata->>file_id=like.*{{ $json.file_id }}*"
      },
      "id": "d041fe0a-348e-4d41-9ea7-2fdfec8aba86",
      "name": "Delete Old Doc Rows",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        540,
        600
      ],
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "5Y1Oqex0loIlvr2b",
          "name": "Supabase account_CSKH"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "10646eae-ae46-4327-a4dc-9987c2d76173",
              "name": "file_id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "f4536df5-d0b1-4392-bf17-b8137fb31a44",
              "name": "file_type",
              "value": "={{ $json.mimeType }}",
              "type": "string"
            },
            {
              "id": "77d782de-169d-4a46-8a8e-a3831c04d90f",
              "name": "file_title",
              "value": "={{ $json.name }}",
              "type": "string"
            },
            {
              "id": "9bde4d7f-e4f3-4ebd-9338-dce1350f9eab",
              "name": "file_url",
              "value": "={{ $json.webViewLink }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "e0b7371f-4cff-4a87-8233-5f2bbcae8c3e",
      "name": "Set File ID",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        280,
        600
      ]
    },
    {
      "parameters": {
        "content": "## RAG AI Agent with Chat Interface",
        "height": 464.8027193303974,
        "width": 1035.6381264595484
      },
      "id": "5fd958d9-1c56-4063-b3d3-19b48ac03ab0",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        720,
        0
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "b5bbaedf-973a-4853-a50f-5c81e53f3afe",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1580,
        80
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9a9a245e-f1a1-4282-bb02-a81ffe629f0f",
              "name": "chatInput",
              "value": "={{ $json?.chatInput || $json.body.chatInput }}",
              "type": "string"
            },
            {
              "id": "b80831d8-c653-4203-8706-adedfdb98f77",
              "name": "sessionId",
              "value": "={{ $json?.sessionId || $json.body.sessionId}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "6dc7167f-512f-46fd-97bc-20ebace37b07",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1020,
        80
      ]
    },
    {
      "parameters": {
        "public": true,
        "options": {}
      },
      "id": "2bace261-1fa0-402d-b4ec-fa2f25f700e3",
      "name": "When chat message received",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        760,
        80
      ],
      "webhookId": "b075f751-8555-407e-bc60-d6879bd1154c"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "12",
        "authentication": "headerAuth",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "3a1db515-1d09-445f-8fb8-fbc97e50b8d2",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        760,
        260
      ],
      "webhookId": "a8511dcc-1b5e-4b56-becb-73d3605dbf98",
      "credentials": {
        "httpHeaderAuth": {
          "id": "1Uia0CdgVhPiuIJL",
          "name": "Header Auth account_TL"
        }
      }
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "id": "8229529f-2093-4e09-bd92-0b7361c73447",
      "name": "Extract PDF Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        2160,
        540
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "0371e550-0e34-4aa8-92af-11a7a14ce33b",
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2220,
        700
      ]
    },
    {
      "parameters": {
        "chunkOverlap": 100
      },
      "id": "749f5917-dfdf-4f8c-aba4-2d8f386d2710",
      "name": "Character Text Splitter",
      "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        3100,
        1320
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "concatenate",
              "field": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "7d7d759e-355d-4e8a-85c0-d839dc177dbc",
      "name": "Summarize",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        2420,
        780
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "=# Prompt cho AI Agent N8n - Tr·ª£ l√Ω T√†i li·ªáu Th√¥ng minh\n\n## Vai tr√≤ v√† Ch·ª©c nƒÉng\nB·∫°n l√† m·ªôt tr·ª£ l√Ω AI chuy√™n nghi·ªáp, gi√∫p t√¨m ki·∫øm v√† truy xu·∫•t th√¥ng tin t·ª´ kho t√†i li·ªáu ƒëa ƒë·ªãnh d·∫°ng. Nhi·ªám v·ª• ch√≠nh c·ªßa b·∫°n l√†:\n\n- T√¨m ki·∫øm th√¥ng tin ch√≠nh x√°c t·ª´ c√°c t√†i li·ªáu vƒÉn b·∫£n (TXT, DOC, PDF)\n- Truy xu·∫•t d·ªØ li·ªáu t·ª´ c√°c file b·∫£ng t√≠nh (CSV, Excel)\n- X·ª≠ l√Ω v√† cung c·∫•p link truy c·∫≠p video khi ƒë∆∞·ª£c y√™u c·∫ßu\n- ƒê·∫£m b·∫£o t√≠nh ch√≠nh x√°c v√† ƒë·∫ßy ƒë·ªß c·ªßa th√¥ng tin ƒë∆∞·ª£c cung c·∫•p\n\n## QUY T·∫ÆC CH√çNH X√ÅC - QUAN TR·ªåNG NH·∫§T\n\n### üîç NGUY√äN T·∫ÆC ƒê·ªåC T√ÄI LI·ªÜU CH√çNH X√ÅC\n1. **ƒê·ªåC K·ª∏ TO√ÄN B·ªò N·ªòI DUNG**: Kh√¥ng ƒë∆∞·ª£c ƒëo√°n ho·∫∑c suy lu·∫≠n t·ª´ t·ª´ kh√≥a\n2. **TR√çCH XU·∫§T CH√çNH X√ÅC**: Copy nguy√™n vƒÉn th√¥ng tin t·ª´ t√†i li·ªáu, kh√¥ng ƒë∆∞·ª£c thay ƒë·ªïi\n3. **KI·ªÇM TRA L·∫†I**: ƒê·ªçc l·∫°i n·ªôi dung tr∆∞·ªõc khi tr·∫£ l·ªùi ƒë·ªÉ ƒë·∫£m b·∫£o ch√≠nh x√°c 100%\n4. **KH√îNG S·ª¨ D·ª§NG KI·∫æN TH·ª®C C≈®**: Ch·ªâ d·ª±a v√†o n·ªôi dung t√†i li·ªáu ƒë∆∞·ª£c t√¨m th·∫•y\n5. **X√ÅC NH·∫¨N NGU·ªíN**: Lu√¥n ghi r√µ th√¥ng tin l·∫•y t·ª´ t√†i li·ªáu n√†o\n\n### üéØ QUY TR√åNH KI·ªÇM TRA CH√çNH X√ÅC\n**B∆Ø·ªöC 1**: T√¨m ki·∫øm t√†i li·ªáu li√™n quan v·ªõi t·ª´ kh√≥a ch√≠nh x√°c\n**B∆Ø·ªöC 2**: ƒê·ªãnh v·ªã ch√≠nh x√°c s·∫£n ph·∫©m/th√¥ng tin c·∫ßn t√¨m trong t√†i li·ªáu\n**B∆Ø·ªöC 3**: ƒê·ªçc k·ªπ TO√ÄN B·ªò ƒëo·∫°n vƒÉn/c√¢u ch·ª©a th√¥ng tin ƒë√≥\n**B∆Ø·ªöC 4**: Tr√≠ch xu·∫•t NGUY√äN VƒÇN th√¥ng tin c·∫ßn thi·∫øt (s·ªë li·ªáu, th·ªùi gian, t√™n s·∫£n ph·∫©m)\n**B∆Ø·ªöC 5**: Ki·ªÉm tra l·∫°i m·ªôt l·∫ßn n·ªØa: ƒë·ªëi chi·∫øu c√¢u h·ªèi v·ªõi th√¥ng tin t√¨m ƒë∆∞·ª£c\n**B∆Ø·ªöC 6**: Ghi r√µ ngu·ªìn t√†i li·ªáu v√† v·ªã tr√≠ th√¥ng tin\n\n**ƒê·∫∂C BI·ªÜT CHO C√ÇU H·ªéI B·∫¢O H√ÄNH**:\n- B∆∞·ªõc 2.1: T√¨m ch√≠nh x√°c t√™n s·∫£n ph·∫©m (v√≠ d·ª•: \"·ªï c·∫£m ƒëi·ªán quang\")\n- B∆∞·ªõc 2.2: T√¨m t·ª´ kh√≥a \"b·∫£o h√†nh\" li√™n quan ƒë·∫øn s·∫£n ph·∫©m ƒë√≥\n- B∆∞·ªõc 2.3: ƒê·ªçc nguy√™n c√¢u ch·ª©a c·∫£ t√™n s·∫£n ph·∫©m v√† th·ªùi h·∫°n b·∫£o h√†nh\n- B∆∞·ªõc 2.4: Kh√¥ng ƒë∆∞·ª£c l·∫•y th√¥ng tin b·∫£o h√†nh c·ªßa s·∫£n ph·∫©m kh√°c\n\n### ‚ö†Ô∏è C·∫¢NH B√ÅO L·ªñI TH∆Ø·ªúNG G·∫∂P\n- **KH√îNG ƒê∆Ø·ª¢C** ƒë·ªçc l∆∞·ªõt ho·∫∑c ƒë·ªçc s∆° s√†i\n- **KH√îNG ƒê∆Ø·ª¢C** thay th·∫ø s·ªë li·ªáu (v√≠ d·ª•: 12 th√°ng th√†nh 6 th√°ng)\n- **KH√îNG ƒê∆Ø·ª¢C** s·ª≠ d·ª•ng th√¥ng tin t·ª´ t√†i li·ªáu kh√°c khi tr·∫£ l·ªùi\n- **KH√îNG ƒê∆Ø·ª¢C** k·∫øt h·ª£p th√¥ng tin t·ª´ nhi·ªÅu ngu·ªìn m√† kh√¥ng ghi r√µ\n- **KH√îNG ƒê∆Ø·ª¢C** suy ƒëo√°n th√¥ng tin kh√¥ng c√≥ trong t√†i li·ªáu\n\n## Quy tr√¨nh X·ª≠ l√Ω Y√™u c·∫ßu\n\n### B∆∞·ªõc 1: Ph√¢n t√≠ch Y√™u c·∫ßu v√† Ki·ªÉm tra Ti√™u ƒë·ªÅ\n- ƒê·ªçc k·ªπ c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng\n- **LU√îN KI·ªÇM TRA TI√äU ƒê·ªÄ T√ÄI LI·ªÜU TR∆Ø·ªöC**: Qu√©t qua t·∫•t c·∫£ ti√™u ƒë·ªÅ ƒë·ªÉ t√¨m t√†i li·ªáu li√™n quan\n- ∆Øu ti√™n t√¨m file .mp4 c√≥ ti√™u ƒë·ªÅ kh·ªõp v·ªõi y√™u c·∫ßu (v√≠ d·ª•: \"h∆∞·ªõng d·∫´n l·∫∑p qu·∫°t 3 c√°nh\" ‚Üí t√¨m ti√™u ƒë·ªÅ ch·ª©a \"qu·∫°t 3 c√°nh\", \"l·∫∑p qu·∫°t\", \"h∆∞·ªõng d·∫´n l·∫Øp qu·∫°t\")\n- N·∫øu c√¢u h·ªèi kh√¥ng r√µ r√†ng, y√™u c·∫ßu l√†m r√µ th√™m\n\n### B∆∞·ªõc 2: Truy v·∫•n Supabase Vector Store\n- **B·∫ÆT BU·ªòC**: Lu√¥n th·ª±c hi·ªán t√¨m ki·∫øm trong Supabase Vector Store\n- S·ª≠ d·ª•ng t·ª´ kh√≥a li√™n quan ƒë·ªÉ t√¨m ki·∫øm to√†n di·ªán\n- Ki·ªÉm tra t·∫•t c·∫£ k·∫øt qu·∫£ tr·∫£ v·ªÅ, bao g·ªìm c·∫£ metadata c·ªßa video\n\n### B∆∞·ªõc 3: Ki·ªÉm tra v√† X√°c th·ª±c D·ªØ li·ªáu - **C·∫¢I TI·∫æN**\n- **ƒê·ªåC K·ª∏ TO√ÄN B·ªò**: ƒê·ªçc t·ª´ng c√¢u, t·ª´ng ƒëo·∫°n vƒÉn c√≥ ch·ª©a th√¥ng tin c·∫ßn thi·∫øt\n- **TR√çCH XU·∫§T NGUY√äN VƒÇN**: Copy ch√≠nh x√°c th√¥ng tin t·ª´ t√†i li·ªáu\n- **KI·ªÇM TRA S·ªê LI·ªÜU**: ƒê·∫∑c bi·ªát ch√∫ √Ω ƒë·∫øn c√°c con s·ªë, th·ªùi gian, s·ªë l∆∞·ª£ng\n- **X√ÅC NH·∫¨N NG√ÄY TH√ÅNG**: Ki·ªÉm tra k·ªπ c√°c th√¥ng tin v·ªÅ th·ªùi h·∫°n, b·∫£o h√†nh\n- **ƒê·ªåC L·∫†I M·ªòT L·∫¶N N·ªÆA**: ƒê·∫£m b·∫£o kh√¥ng c√≥ sai s√≥t tr∆∞·ªõc khi tr·∫£ l·ªùi\n\n### B∆∞·ªõc 4: X·ª≠ l√Ω ƒê·∫∑c bi·ªát cho Video v√† H∆∞·ªõng d·∫´n\n- **QUY T·∫ÆC QUAN TR·ªåNG**: Ch·ªâ d·ª±a v√†o TI√äU ƒê·ªÄ file .mp4 ƒë·ªÉ x√°c ƒë·ªãnh n·ªôi dung video\n- **KH√îNG XEM** ƒë∆∞·ª£c n·ªôi dung b√™n trong video, ch·ªâ ph√¢n t√≠ch ti√™u ƒë·ªÅ\n- **TH·ª® T·ª∞ ∆ØU TI√äN**:\n  1. T√¨m file .mp4 c√≥ ti√™u ƒë·ªÅ kh·ªõp v·ªõi y√™u c·∫ßu ‚Üí Tr·∫£ link ngay l·∫≠p t·ª©c\n  2. Sau ƒë√≥ m·ªõi t√¨m n·ªôi dung trong t√†i li·ªáu vƒÉn b·∫£n kh√°c\n- **V√ç D·ª§**: H·ªèi \"h∆∞·ªõng d·∫´n l·∫∑p qu·∫°t 3 c√°nh\" ‚Üí T√¨m ti√™u ƒë·ªÅ .mp4 ch·ª©a \"qu·∫°t 3 c√°nh\" ho·∫∑c \"l·∫∑p qu·∫°t\"\n- Ki·ªÉm tra trong file Excel/CSV c√≥ ch·ª©a URL video v·ªõi ti√™u ƒë·ªÅ ph√π h·ª£p\n\n## Nguy√™n t·∫Øc Ho·∫°t ƒë·ªông\n\n### ‚úÖ PH·∫¢I L√ÄM\n- **LU√îN KI·ªÇM TRA TI√äU ƒê·ªÄ TR∆Ø·ªöC**: Qu√©t to√†n b·ªô danh s√°ch ti√™u ƒë·ªÅ t√†i li·ªáu tr∆∞·ªõc khi t√¨m ki·∫øm\n- **∆ØU TI√äN VIDEO .MP4**: T√¨m file .mp4 c√≥ ti√™u ƒë·ªÅ li√™n quan ƒë·∫ßu ti√™n\n- **CH·ªà D·ª∞A V√ÄO TI√äU ƒê·ªÄ**: Kh√¥ng suy ƒëo√°n n·ªôi dung video, ch·ªâ ph√¢n t√≠ch ti√™u ƒë·ªÅ file\n- **TH·ª® T·ª∞**: Video .mp4 tr∆∞·ªõc ‚Üí Link ngay ‚Üí Sau ƒë√≥ m·ªõi t√¨m t√†i li·ªáu kh√°c\n- **ƒê·ªåC CH√çNH X√ÅC**: ƒê·ªçc k·ªπ to√†n b·ªô n·ªôi dung li√™n quan tr∆∞·ªõc khi tr·∫£ l·ªùi\n- **TR√çCH XU·∫§T NGUY√äN VƒÇN**: Copy ch√≠nh x√°c th√¥ng tin t·ª´ t√†i li·ªáu\n- Cung c·∫•p th√¥ng tin ch√≠nh x√°c 100% t·ª´ ngu·ªìn d·ªØ li·ªáu\n- Tr·∫£ v·ªÅ link video clickable ƒë·ªÉ ng∆∞·ªùi d√πng xem tr·ª±c ti·∫øp\n- **GHI R√ï NGU·ªíN**: Lu√¥n ch·ªâ r√µ th√¥ng tin l·∫•y t·ª´ t√†i li·ªáu n√†o\n\n### ‚ùå KH√îNG ƒê∆Ø·ª¢C L√ÄM\n- B·ªãa ƒë·∫∑t ho·∫∑c suy di·ªÖn n·ªôi dung video t·ª´ ti√™u ƒë·ªÅ\n- **KH√îNG ƒêO√ÅN** n·ªôi dung b√™n trong file .mp4\n- **KH√îNG ƒê·ªåC L∆Ø·ªöT**: Ph·∫£i ƒë·ªçc k·ªπ to√†n b·ªô n·ªôi dung li√™n quan\n- **KH√îNG THAY ƒê·ªîI S·ªê LI·ªÜU**: Gi·ªØ nguy√™n c√°c con s·ªë t·ª´ t√†i li·ªáu g·ªëc\n- **KH√îNG S·ª¨ D·ª§NG KI·∫æN TH·ª®C C≈®**: Ch·ªâ d·ª±a v√†o t√†i li·ªáu ƒë∆∞·ª£c t√¨m th·∫•y\n- B·ªè qua vi·ªác ki·ªÉm tra ti√™u ƒë·ªÅ tr∆∞·ªõc khi t√¨m ki·∫øm\n- T√¨m t√†i li·ªáu kh√°c tr∆∞·ªõc khi ki·ªÉm tra video .mp4\n- Tr·∫£ l·ªùi m√† kh√¥ng ki·ªÉm tra danh s√°ch ti√™u ƒë·ªÅ ƒë·∫ßy ƒë·ªß\n- ƒê∆∞a ra th√¥ng tin kh√¥ng ch√≠nh x√°c v·ªÅ video\n- **KH√îNG K·∫æT H·ª¢P TH√îNG TIN**: M·ªói c√¢u tr·∫£ l·ªùi ph·∫£i c√≥ ngu·ªìn r√µ r√†ng\n\n## C√°ch Ph·∫£n h·ªìi\n\n### Khi t√¨m th·∫•y video .mp4 ph√π h·ª£p:\n```\nüé• **T√åM TH·∫§Y VIDEO H∆Ø·ªöNG D·∫™N**: \n\nüëâ **[Ti√™u ƒë·ªÅ video]** - [Link video tr·ª±c ti·∫øp - Click ƒë·ªÉ xem]\n\nüìù **Ghi ch√∫**: Video ƒë∆∞·ª£c x√°c ƒë·ªãnh d·ª±a tr√™n ti√™u ƒë·ªÅ \"[ti√™u ƒë·ªÅ file]\"\n\n---\nüìö **Th√¥ng tin b·ªï sung t·ª´ t√†i li·ªáu kh√°c** (n·∫øu c√≥):\n[N·ªôi dung t·ª´ t√†i li·ªáu vƒÉn b·∫£n li√™n quan]\n**Ngu·ªìn**: [T√™n file c·ª• th·ªÉ]\n```\n\n### Khi t√¨m th·∫•y th√¥ng tin kh√°c:\n```\nD·ª±a tr√™n t√†i li·ªáu **[t√™n t√†i li·ªáu c·ª• th·ªÉ]**, t√¥i t√¨m th·∫•y th√¥ng tin ch√≠nh x√°c sau:\n\n**\"[Tr√≠ch d·∫´n nguy√™n vƒÉn t·ª´ t√†i li·ªáu]\"**\n\n[N·∫øu c√≥ video]: üé• Link video: [URL]\n\nüìã **Ngu·ªìn ch√≠nh x√°c**: [T√™n file/t√†i li·ªáu] - [V·ªã tr√≠ trong t√†i li·ªáu n·∫øu c√≥]\n```\n\n### Khi c√≥ th√¥ng tin s·ªë li·ªáu c·ª• th·ªÉ:\n```\nTheo t√†i li·ªáu **[t√™n file]**, th√¥ng tin ch√≠nh x√°c l√†:\n\nüîç **[C√¢u h·ªèi]**: **[Tr·∫£ l·ªùi nguy√™n vƒÉn t·ª´ t√†i li·ªáu]**\n\nüìù **Tr√≠ch d·∫´n nguy√™n vƒÉn**: \"[ƒêo·∫°n vƒÉn ch√≠nh x√°c t·ª´ t√†i li·ªáu]\"\n\n‚ö†Ô∏è **L∆∞u √Ω**: Th√¥ng tin n√†y ch·ªâ √°p d·ª•ng cho [t√™n s·∫£n ph·∫©m c·ª• th·ªÉ]\n\nüìã **Ngu·ªìn**: [T√™n file c·ª• th·ªÉ]\n```\n\n### V√≠ d·ª• c·ª• th·ªÉ cho c√¢u h·ªèi b·∫£o h√†nh:\n```\nüîç **C√¢u h·ªèi**: \"·ªï c·∫£m ƒëi·ªán quang b·∫£o h√†nh bao l√¢u?\"\n\n‚úÖ **C√°ch tr·∫£ l·ªùi ƒë√∫ng**:\nTheo t√†i li·ªáu **[t√™n file]**, th√¥ng tin ch√≠nh x√°c l√†:\n\nüõ°Ô∏è **·ªî c·∫£m ƒëi·ªán quang ƒë∆∞·ª£c b·∫£o h√†nh: 12 th√°ng**\n\nüìù **Tr√≠ch d·∫´n nguy√™n vƒÉn**: \"[ƒêo·∫°n vƒÉn ch√≠nh x√°c t·ª´ t√†i li·ªáu ch·ª©a th√¥ng tin v·ªÅ ·ªï c·∫£m ƒëi·ªán quang v√† th·ªùi h·∫°n 12 th√°ng]\"\n\nüìã **Ngu·ªìn**: [T√™n file ch·ª©a th√¥ng tin n√†y]\n\n‚ùå **TUY·ªÜT ƒê·ªêI KH√îNG ƒê∆Ø·ª¢C** tr·∫£ l·ªùi: \"6 th√°ng\" n·∫øu t√†i li·ªáu ghi \"12 th√°ng\"\n```\n\n### Khi kh√¥ng t√¨m th·∫•y th√¥ng tin:\n```\nT√¥i ƒë√£ t√¨m ki·∫øm trong to√†n b·ªô kho t√†i li·ªáu nh∆∞ng kh√¥ng t√¨m th·∫•y th√¥ng tin v·ªÅ [ch·ªß ƒë·ªÅ]. \n\nB·∫°n c√≥ th·ªÉ cung c·∫•p th√™m chi ti·∫øt ho·∫∑c t·ª´ kh√≥a kh√°c ƒë·ªÉ t√¥i h·ªó tr·ª£ t·ªët h∆°n kh√¥ng?\n```\n\n### Khi c·∫ßn l√†m r√µ:\n```\nƒê·ªÉ t√¥i c√≥ th·ªÉ h·ªó tr·ª£ ch√≠nh x√°c, b·∫°n c√≥ th·ªÉ l√†m r√µ th√™m v·ªÅ:\n- [C√¢u h·ªèi c·ª• th·ªÉ 1]\n- [C√¢u h·ªèi c·ª• th·ªÉ 2]\n```\n\n## L∆∞u √Ω ƒê·∫∑c bi·ªát\n\n1. **KI·ªÇM TRA TI√äU ƒê·ªÄ ƒê·∫¶U TI√äN**: Lu√¥n qu√©t danh s√°ch ti√™u ƒë·ªÅ t√†i li·ªáu tr∆∞·ªõc m·ªçi thao t√°c kh√°c\n2. **GI·ªöI H·∫†N VIDEO**: Ch·ªâ bi·∫øt n·ªôi dung video qua ti√™u ƒë·ªÅ file .mp4, kh√¥ng xem ƒë∆∞·ª£c b√™n trong\n3. **TH·ª® T·ª∞ X·ª¨ L√ù**: Ti√™u ƒë·ªÅ .mp4 ‚Üí Link video ‚Üí T√†i li·ªáu vƒÉn b·∫£n ‚Üí T·ªïng h·ª£p\n4. **V√ç D·ª§ TH·ª∞C T·∫æ**: \n   - H·ªèi: \"h∆∞·ªõng d·∫´n l·∫∑p qu·∫°t 3 c√°nh\"\n   - T√¨m: Ti√™u ƒë·ªÅ ch·ª©a \"qu·∫°t 3 c√°nh\", \"l·∫∑p qu·∫°t\", \"h∆∞·ªõng d·∫´n qu·∫°t\"\n   - Tr·∫£ v·ªÅ: Link video ngay l·∫≠p t·ª©c\n5. **T·ª´ kh√≥a Matching**: So kh·ªõp t·ª´ kh√≥a trong c√¢u h·ªèi v·ªõi ti√™u ƒë·ªÅ file\n6. **Link Click-able**: ƒê·∫£m b·∫£o link video c√≥ th·ªÉ click tr·ª±c ti·∫øp\n7. **Ki·ªÉm tra Metadata**: Xem x√©t metadata c·ªßa file Excel/CSV ch·ª©a URL video\n8. **V√ç D·ª§ L·ªñI C·∫¶N TR√ÅNH**: \n   - ‚ùå T√†i li·ªáu ghi \"12 th√°ng\" nh∆∞ng tr·∫£ l·ªùi \"6 th√°ng\"\n   - ‚úÖ Ph·∫£i tr·∫£ l·ªùi ch√≠nh x√°c \"12 th√°ng\" nh∆∞ trong t√†i li·ªáu\n   \n9. **TR∆Ø·ªúNG H·ª¢P TH·ª∞C T·∫æ C·∫¶N CH√ö √ù**:\n   ```\n   üîç C√¢u h·ªèi: \"·ªï c·∫£m ƒëi·ªán quang b·∫£o h√†nh bao l√¢u?\"\n   \n   ‚ùå SAI: \"·ªî c·∫£m ƒëi·ªán quang ƒë∆∞·ª£c b·∫£o h√†nh 6 th√°ng\"\n   ‚úÖ ƒê√öNG: \"Theo t√†i li·ªáu [t√™n file], ·ªï c·∫£m ƒëi·ªán quang ƒë∆∞·ª£c b·∫£o h√†nh 12 th√°ng\"\n   \n   üìù Nguy√™n nh√¢n l·ªói: ƒê·ªçc nh·∫ßm ho·∫∑c l·∫•y th√¥ng tin t·ª´ s·∫£n ph·∫©m kh√°c\n   üîß C√°ch kh·∫Øc ph·ª•c: ƒê·ªçc k·ªπ ƒëo·∫°n vƒÉn ch·ª©a t·ª´ \"·ªï c·∫£m ƒëi·ªán quang\" v√† \"b·∫£o h√†nh\"\n   ```\n\n10. **NGUY√äN T·∫ÆC V√ÄNG**: N·∫øu kh√¥ng ch·∫Øc ch·∫Øn, ƒë·ªçc l·∫°i t√†i li·ªáu m·ªôt l·∫ßn n·ªØa\n\n## C√¥ng c·ª• C·∫ßn s·ª≠ d·ª•ng\n- Supabase Vector Store Query Tool\n- Document Analysis Tool  \n- Excel/CSV Reader Tool\n- Video Link Extractor Tool\n\n---\n*Ghi nh·ªõ: T√≠nh ch√≠nh x√°c 100% l√† ∆∞u ti√™n tuy·ªát ƒë·ªëi. Lu√¥n ƒë·ªçc k·ªπ, tr√≠ch xu·∫•t nguy√™n vƒÉn, v√† ki·ªÉm tra l·∫°i tr∆∞·ªõc khi tr·∫£ l·ªùi. M·ªçi sai s√≥t v·ªÅ s·ªë li·ªáu ƒë·ªÅu kh√¥ng ƒë∆∞·ª£c ch·∫•p nh·∫≠n.*"
        }
      },
      "id": "475659d2-fd8f-4436-a51a-77429623d2e1",
      "name": "RAG AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        1240,
        80
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "application/pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "2d5d8bc1-7088-4b65-a833-301c3987bfbe"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pdf"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "2ae7faa7-a936-4621-a680-60c512163034",
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "fc193b06-363b-4699-a97d-e5a850138b0e",
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "=application/vnd.google-apps.spreadsheet",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "b69f5605-0179-4b02-9a32-e34bb085f82d",
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "application/vnd.google-apps.document",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "a605d52b-093e-47ce-bed4-6c040b465b79",
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "application/msword",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "043262f3-55dc-40b0-af44-f2f67aae3aa9",
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "291a9806-5b16-46b4-a253-4806491d92bc",
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "application/vnd.ms-word",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": 3
        }
      },
      "id": "1ceb47a7-44bb-46be-a1ab-5a3ab4c1b1e1",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        1320,
        720
      ]
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "e1204833-4ffb-4335-9645-e85e95682900",
      "name": "Insert into Supabase Vectorstore",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        2900,
        860
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5Y1Oqex0loIlvr2b",
          "name": "Supabase account_CSKH"
        }
      }
    },
    {
      "parameters": {
        "operation": "xlsx",
        "options": {}
      },
      "id": "aedf77fb-b6e2-4a38-a21a-dba192e565c0",
      "name": "Extract from Excel",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1780,
        700
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f422e2e0-381c-46ea-8f38-3f58c501d8b9",
              "name": "schema",
              "value": "={{ $('Extract from Excel').isExecuted ? $('Extract from Excel').first().json.keys().toJsonString() : $('Extract from CSV').first().json.keys().toJsonString() }}",
              "type": "string"
            },
            {
              "id": "bb07c71e-5b60-4795-864c-cc3845b6bc46",
              "name": "data",
              "value": "={{ $json.concatenated_data }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2860,
        640
      ],
      "id": "e5805b54-4778-49c9-80e7-4bf5410b5779",
      "name": "Set Schema"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1780,
        880
      ],
      "id": "412d6ae7-4e96-4b64-8ffb-061a2e77c737",
      "name": "Extract from CSV"
    },
    {
      "parameters": {
        "content": "## Run Each Node Once to Set Up Database Tables",
        "height": 300,
        "width": 680,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "typeVersion": 1,
      "id": "9689a5d7-eff2-462a-96ff-4641ebc6c166",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Use this tool to fetch all available documents, including the table schema if the file is a CSV or Excel file.",
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        1300,
        300
      ],
      "id": "39a1f24f-b187-40b3-9cc8-f053481bc136",
      "name": "List Documents",
      "credentials": {
        "postgres": {
          "id": "vEJzSvEtz2wK5mnU",
          "name": "Postgres account 18_CSKH"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Given a file ID, fetches the text from the document.",
        "operation": "executeQuery",
        "query": "SELECT \n    string_agg(content, ' ') as document_text\nFROM documents\n  WHERE metadata->>'file_id' = $1\nGROUP BY metadata->>'file_id';",
        "options": {
          "queryReplacement": "={{ $fromAI('file_id') }}"
        }
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        1440,
        300
      ],
      "id": "cbeb40b4-502f-42b7-a828-321e33efd8e2",
      "name": "Get File Contents",
      "credentials": {
        "postgres": {
          "id": "vEJzSvEtz2wK5mnU",
          "name": "Postgres account 18_CSKH"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "documents",
        "toolDescription": "Use RAG to look up information in the knowledgebase.",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        1880,
        220
      ],
      "id": "7ae32dc6-950c-4099-a9e4-2ac613423bbc",
      "name": "Supabase Vector Store1",
      "credentials": {
        "supabaseApi": {
          "id": "5Y1Oqex0loIlvr2b",
          "name": "Supabase account_CSKH"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1980,
        340
      ],
      "id": "1bad4ea0-4547-44f3-8454-c64605b1f867",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "BpciZCOgdpJ79QO1",
          "name": "OpenAi account 23062025"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        20,
        580
      ],
      "id": "93404ed8-a966-4efd-9d30-90d32dd37841",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- K√≠ch ho·∫°t extension pgvector\nCREATE EXTENSION IF NOT EXISTS vector;\n\n-- T·∫°o b·∫£ng l∆∞u metadata c·ªßa t√†i li·ªáu\nCREATE TABLE document_metadata (\n    id TEXT PRIMARY KEY,\n    title TEXT,\n    url TEXT,\n    created_at TIMESTAMP DEFAULT NOW(),\n    schema TEXT\n);\n\n-- T·∫°o b·∫£ng l∆∞u c√°c d√≤ng d·ªØ li·ªáu c·ªßa t√†i li·ªáu\nCREATE TABLE document_rows (\n    id SERIAL PRIMARY KEY,\n    dataset_id TEXT REFERENCES document_metadata(id),\n    row_data JSONB  -- L∆∞u tr·ªØ d·ªØ li·ªáu d√≤ng th·ª±c t·∫ø\n);\n\n-- T·∫°o b·∫£ng l∆∞u tr·ªØ t√†i li·ªáu v√† embedding c·ªßa ch√∫ng\nCREATE TABLE documents (\n  id BIGSERIAL PRIMARY KEY,\n  content TEXT,  -- N·ªôi dung t√†i li·ªáu\n  metadata JSONB,  -- Metadata c·ªßa t√†i li·ªáu\n  embedding VECTOR(1536)  -- 1536 l√† k√≠ch th∆∞·ªõc c·ªßa embedding, c√≥ th·ªÉ thay ƒë·ªïi t√πy theo nhu c·∫ßu\n);\n\n-- T·∫°o h√†m ƒë·ªÉ t√¨m ki·∫øm t√†i li·ªáu d·ª±a tr√™n embedding\nCREATE FUNCTION match_documents (\n  query_embedding VECTOR(1536),\n  match_count INT DEFAULT NULL,\n  filter JSONB DEFAULT '{}'\n) RETURNS TABLE (\n  doc_id BIGINT,\n  content TEXT,\n  metadata JSONB,\n  similarity FLOAT\n)\nLANGUAGE plpgsql\nAS $$\nBEGIN\n  RETURN QUERY\n  SELECT\n    documents.id AS doc_id,  -- ƒê·ªïi t√™n c·ªôt 'id' c·ªßa b·∫£ng 'documents' th√†nh 'doc_id'\n    documents.content,\n    documents.metadata,\n    1 - (documents.embedding <=> query_embedding) AS similarity\n  FROM documents\n  WHERE documents.metadata @> filter\n  ORDER BY documents.embedding <=> query_embedding\n  LIMIT match_count;\nEND;\n$$;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        280,
        100
      ],
      "id": "0be0958e-6442-4db3-b631-53c9b32c07aa",
      "name": "Create Documents Table and Match Function",
      "credentials": {
        "postgres": {
          "id": "vEJzSvEtz2wK5mnU",
          "name": "Postgres account 18_CSKH"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "document_rows",
        "filters": {
          "conditions": [
            {
              "keyName": "dataset_id",
              "condition": "eq",
              "keyValue": "={{ $('Set File ID').item.json.file_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        740,
        600
      ],
      "id": "d7a9414e-cc40-42c8-b46e-ad4f12a0c390",
      "name": "Delete Old Data Rows",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "5Y1Oqex0loIlvr2b",
          "name": "Supabase account_CSKH"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Set File ID').item.json.file_id }}",
            "title": "={{ $('Set File ID').item.json.file_title }}",
            "url": "={{ $('Set File ID').item.json.file_url }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": true,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": false
            },
            {
              "id": "schema",
              "displayName": "schema",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        900,
        600
      ],
      "id": "6f8c731f-37b9-4ace-9e04-7cc564cc4cf9",
      "name": "Insert Document Metadata",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "vEJzSvEtz2wK5mnU",
          "name": "Postgres account 18_CSKH"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_rows",
          "mode": "list",
          "cachedResultName": "document_rows"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "dataset_id": "={{ $('Set File ID').item.json.file_id }}",
            "row_data": "={{ $json.toJsonString().replaceAll(/'/g, \"''\") }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "dataset_id",
              "displayName": "dataset_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_data",
              "displayName": "row_data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        2220,
        880
      ],
      "id": "c5ec73a0-b756-4624-97a7-5e56e728b31f",
      "name": "Insert Table Rows",
      "credentials": {
        "postgres": {
          "id": "vEJzSvEtz2wK5mnU",
          "name": "Postgres account 18_CSKH"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Set File ID').item.json.file_id }}",
            "schema": "={{ $json.schema }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": true,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": false
            },
            {
              "id": "schema",
              "displayName": "schema",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        3080,
        640
      ],
      "id": "a2b159c1-c4a2-49ce-b9ab-a4faec6909b5",
      "name": "Update Schema for Document Metadata",
      "credentials": {
        "postgres": {
          "id": "vEJzSvEtz2wK5mnU",
          "name": "Postgres account 18_CSKH"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y hai m·∫£ng t·ª´ input trong n8n\nconst array1 = $('Aggregate1').first().json.id || [];\nconst array2 = $('Aggregate2').first().json.id || [];\n\n// T√¨m c√°c ID kh√¥ng tr√πng nhau\nconst uniqueIDs = [\n  ...array1.filter(id => !array2.includes(id)), // ID ch·ªâ c√≥ trong array1\n  ...array2.filter(id => !array1.includes(id))  // ID ch·ªâ c√≥ trong array2\n];\n// Chuy·ªÉn ƒë·ªïi k·∫øt qu·∫£ th√†nh ƒë·ªãnh d·∫°ng mong mu·ªën\nconst result = uniqueIDs.map(id => ({ id }));\n\n// Tr·∫£ v·ªÅ k·∫øt qu·∫£\nreturn result;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1060,
        1660
      ],
      "id": "839fc4b4-bda5-41d0-9cfd-60140e327a5f",
      "name": "Code"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT id  FROM public.document_metadata;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        320,
        1660
      ],
      "id": "46c2b210-4cbc-4a65-bc71-24847f72b090",
      "name": "Node_postgres",
      "credentials": {
        "postgres": {
          "id": "vEJzSvEtz2wK5mnU",
          "name": "Postgres account 18_CSKH"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "resource": "fileFolder",
        "returnAll": true,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "17AhhZ1lMv23PM2TEdOngMqirnCMfAeY7",
            "mode": "list",
            "cachedResultName": "04. N8n_Tro_Ly_Doc",
            "cachedResultUrl": "https://drive.google.com/drive/folders/17AhhZ1lMv23PM2TEdOngMqirnCMfAeY7"
          },
          "whatToSearch": "files",
          "includeTrashed": false
        },
        "options": {
          "fields": [
            "id"
          ]
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        680,
        1660
      ],
      "id": "8f109c2f-1bd9-4796-933c-6fcc43a29aa2",
      "name": "Node_drive",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "UFYSZcd8CgntABwS",
          "name": "GSA_N"
        }
      }
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "id"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        500,
        1660
      ],
      "id": "f1aebd0d-9b02-46a4-824f-db2586f679fb",
      "name": "Aggregate1"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "id"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        860,
        1660
      ],
      "id": "43abef2c-6f7d-41e2-974f-feb02fe441f3",
      "name": "Aggregate2"
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "documents",
        "filterType": "string",
        "filterString": "=metadata->>file_id=like.*{{ $('Loop Over Items1').item.json.id }}*"
      },
      "id": "e2b57d7c-b28e-4088-86a9-77ee807a1415",
      "name": "Delete Old Doc Rows1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2080,
        1660
      ],
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "5Y1Oqex0loIlvr2b",
          "name": "Supabase account_CSKH"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "document_metadata",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Loop Over Items1').item.json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1900,
        1660
      ],
      "id": "61e24eba-2b5a-4324-8061-4f979548a35b",
      "name": "Delete Old Data Rows2",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "5Y1Oqex0loIlvr2b",
          "name": "Supabase account_CSKH"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "document_rows",
        "filters": {
          "conditions": [
            {
              "keyName": "dataset_id",
              "condition": "eq",
              "keyValue": "={{ $json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1720,
        1660
      ],
      "id": "75578791-e411-41d6-8415-72ec41d9b78f",
      "name": "Delete Old Data Rows1",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "5Y1Oqex0loIlvr2b",
          "name": "Supabase account_CSKH"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7134e92c-2e4f-49b3-a0d1-dbe856ebef2c",
              "leftValue": "={{ $('Code').item}}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1240,
        1660
      ],
      "id": "9f1ad845-12f0-4894-b84e-e887d2715c9d",
      "name": "If"
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1460,
        1640
      ],
      "id": "1d0b07c0-e06d-44cf-8aa2-0767fdc3c98f",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        100,
        1660
      ],
      "id": "f9e83726-651b-44f2-b287-70007b61746b",
      "name": "Schedule Trigger",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "deleteFile",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Set File ID').item.json.file_id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2000,
        1300
      ],
      "id": "8c7ef012-8bce-4704-9a6f-f03d815a6506",
      "name": "Delete File",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "rxFyTs7otauqN2lC",
          "name": "Google Drive account 9"
        }
      }
    },
    {
      "parameters": {
        "operation": "text",
        "options": {}
      },
      "id": "253ba4cf-be8e-402a-9b0d-df4d62322de8",
      "name": "Extract Document Text1",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1800,
        1060
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "document_metadata",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Set File ID').item.json.file_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2160,
        1300
      ],
      "id": "0f083fec-b8ee-46f7-bc98-c0da479fd710",
      "name": "Delete Old Data Rows3",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "5Y1Oqex0loIlvr2b",
          "name": "Supabase account_CSKH"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://www.googleapis.com/drive/v3/files/{{ $('Set File ID').item.json.file_id }}/copy",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "name",
              "value": "={{ $json.title }}"
            },
            {
              "name": "mimeType",
              "value": "application/vnd.google-apps.document"
            }
          ]
        },
        "options": {}
      },
      "id": "21b173e7-cee5-4c6c-bcf8-ed58817a2497",
      "name": "Convert to Google Doc",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1820,
        1300
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "rxFyTs7otauqN2lC",
          "name": "Google Drive account 9"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "21651ed3-cfa6-4ef8-940b-fb734b9e4fc5",
              "leftValue": "={{ $('Set File ID').item.json.file_type }}",
              "rightValue": "video/mp4",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        940,
        820
      ],
      "id": "fa5005d5-8f38-4737-b8cc-88843e4c54ce",
      "name": "If1"
    }
  ],
  "pinData": {},
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Download File": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "File Created": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Doc Rows": {
      "main": [
        [
          {
            "node": "Delete Old Data Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set File ID": {
      "main": [
        [
          {
            "node": "Delete Old Doc Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "File Updated": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "RAG AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract PDF Text": {
      "main": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Summarize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Summarize": {
      "main": [
        [
          {
            "node": "Set Schema",
            "type": "main",
            "index": 0
          },
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RAG AI Agent": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Extract PDF Text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract from Excel",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract from CSV",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Document Text1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Convert to Google Doc",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Convert to Google Doc",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Convert to Google Doc",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from Excel": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          },
          {
            "node": "Insert Table Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Schema": {
      "main": [
        [
          {
            "node": "Update Schema for Document Metadata",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from CSV": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          },
          {
            "node": "Insert Table Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "List Documents": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get File Contents": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store1": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Set File ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert into Supabase Vectorstore": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Data Rows": {
      "main": [
        [
          {
            "node": "Insert Document Metadata",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert Document Metadata": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Node_postgres": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Node_drive": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Node_drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Data Rows2": {
      "main": [
        [
          {
            "node": "Delete Old Doc Rows1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Data Rows1": {
      "main": [
        [
          {
            "node": "Delete Old Data Rows2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "Delete Old Data Rows1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Doc Rows1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Node_postgres",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete File": {
      "main": [
        [
          {
            "node": "Delete Old Data Rows3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Document Text1": {
      "main": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Data Rows3": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to Google Doc": {
      "main": [
        [
          {
            "node": "Delete File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Download File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "a9045c01-9c43-4cb0-a28e-08533dbb95cb",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "94a383c02457267bcc44878635a0fa02b7d3206c5479bfc8890faa812e2bbd97"
  },
  "id": "7NPTdTbMt1JcEX0o",
  "tags": []
}